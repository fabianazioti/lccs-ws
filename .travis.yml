language: python

cache:
    directories:
        - $HOME/.cache/pip

branches:
    only:
        - master
        - b-0.2

dist: bionic

python:
    - "3.7"

env:
  matrix:
  - SQLALCHEMY_DATABASE_URI="postgresql://postgres:postgres@localhost:5432/bdc_lccs"


before_install:
    - pip install --upgrade pip
    - pip install --upgrade setuptools

install:
    - pip install -e .[tests,docs]
    - docker pull postgis/postgis:12-3.0

before_script:
    - docker run --name bdc_pg -p 5432:5432 -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgres -d postgis/postgis:12-3.0
    - docker ps -a
    - lccs_db db init
    - lccs_db db create-namespaces
    - lccs_db alembic upgrade
    - lccs_db db load-scripts

script:
    - ./run-tests.sh

after_success:
    - docker stop bdc_pg
    - docker rm bdc_pg
    - coveralls